#!/usr/bin/env zsh

# OBSOLETE: This script is no longer needed
# The Emacs daemon is now managed by home-manager service
# which automatically starts and maintains the daemon
#
# Helper function to ensure daemon is running and return socket path
socket_path=$(doom-socket)

if [[ -z "$socket_path" ]]; then
    echo "Emacs daemon not found. Starting via home-manager service..." >&2
    emacs-service-toggle start >/dev/null 2>&1 || true

    # Wait for daemon to start and create socket
    retries=0
    while [[ -z "$socket_path" && $retries -lt 18 ]]; do
        sleep 0.5
        socket_path=$(doom-socket)
        ((retries++))
    done

    if [[ -z "$socket_path" ]]; then
        echo "Failed to start Emacs daemon or find socket after 9 seconds" >&2
        exit 1
    fi
fi

echo "$socket_path"
