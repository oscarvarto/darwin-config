#!/usr/bin/env zsh

# OBSOLETE: This script is no longer needed
# The Emacs daemon is now managed by home-manager service
# which uses the default socket at $TMPDIR/emacs$(id -u)/server
#
# Find the doom socket file in TMPDIR
socket_file=$(fd -ts doom "${TMPDIR:-/tmp}" 2>/dev/null | head -n1)

if [[ -z "$socket_file" ]]; then
    exit 1
fi

# Test if the socket is actually active by trying to connect
if "$HOME/.nix-profile/bin/emacsclient" -s "$socket_file" --eval "t" >/dev/null 2>&1; then
    echo "$socket_file"
else
    # Socket file exists but is stale, remove it
    rm -f "$socket_file"
    exit 1
fi
