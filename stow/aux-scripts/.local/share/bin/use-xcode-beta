#!/bin/bash

# Script to switch xcode-select to use Xcode beta
# This ensures that command line tools use the beta version

set -euo pipefail

XCODE_BETA_PATH="/Applications/Xcode-beta.app"
XCODE_BETA_DEVELOPER_PATH="${XCODE_BETA_PATH}/Contents/Developer"

if [[ ! -d "$XCODE_BETA_PATH" ]]; then
    echo "‚ùå Error: Xcode beta not found at $XCODE_BETA_PATH"
    echo "Please install Xcode beta from the Apple Developer Portal"
    exit 1
fi

echo "üîÑ Switching xcode-select to Xcode beta..."
sudo xcode-select -s "$XCODE_BETA_DEVELOPER_PATH"

# Verify the switch
CURRENT_PATH=$(xcode-select -p)
if [[ "$CURRENT_PATH" == "$XCODE_BETA_DEVELOPER_PATH" ]]; then
    echo "‚úÖ Successfully switched to Xcode beta"
    echo "   Developer directory: $CURRENT_PATH"
    
    # Show Xcode version
    if command -v xcodebuild &> /dev/null; then
        echo "   Xcode version: $(xcodebuild -version | head -n1)"
    fi
else
    echo "‚ùå Failed to switch to Xcode beta"
    echo "   Current path: $CURRENT_PATH"
    echo "   Expected: $XCODE_BETA_DEVELOPER_PATH"
    exit 1
fi

echo ""
echo "üí° Note: The DEVELOPER_DIR environment variable is also set in your shell config"
echo "   to point to Xcode beta for consistent behavior across all tools."
