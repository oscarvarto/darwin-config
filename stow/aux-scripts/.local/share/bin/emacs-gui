#!/usr/bin/env zsh

# Emacs GUI launcher that always uses emacsclient
# This script should be used when launching Emacs from the Dock or Spotlight

# Try to use emacsclient first
if "$HOME/.nix-profile/bin/emacsclient" -e "(emacs-version)" >/dev/null 2>&1; then
    # Server is running, create a new frame
    exec "$HOME/.nix-profile/bin/emacsclient" -nc "$@"
else
    # Server should be managed by home-manager service
    # Wait a moment for it to start/restart
    sleep 1
    
    # Try again
    if "$HOME/.nix-profile/bin/emacsclient" -e "(emacs-version)" >/dev/null 2>&1; then
        exec "$HOME/.nix-profile/bin/emacsclient" -nc "$@"
    else
        # Last resort: launch standalone Emacs (shouldn't happen)
        exec "$HOME/.nix-profile/bin/emacs" "$@"
    fi
fi